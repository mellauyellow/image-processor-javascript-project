{"version":3,"sources":["webpack:///webpack/bootstrap 3f71984c1a90480317a3","webpack:///./lib/tableau.js","webpack:///./lib/image.js","webpack:///./lib/filter.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;ACtCA;;;AAGA;AACA;AACA,EAAC;;;;;;;ACLD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA,qCAAoC,sEAAsE;AAC1G;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,qDAAoD,UAAU;AAC9D;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAQ;;AAER;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,QAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA,MAAK;AACL;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,wCAAuC,2DAA2D;AAClG;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;;AAEA;AACA,MAAK;AACL;AACA;;AAEA;;;;;;;ACpQA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA,oBAAmB,iBAAiB;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,oBAAmB,qBAAqB;AACxC;;AAEA;AACA;AACA;AACA,QAAO;AACP;AACA;;AAEA;;AAEA;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;;AAEA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;;AAEA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,oBAAmB,8BAA8B;AACjD,sBAAqB,+BAA+B;AACpD;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;;AAEA;AACA,oBAAmB,8BAA8B;AACjD,sBAAqB,+BAA+B;AACpD;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;;AAEA,oBAAmB,8BAA8B;AACjD,sBAAqB,+BAA+B;AACpD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,qDAAoD,oEAAoE;AACxH;AACA;;AAEA;AACA;;AAEA;AACA;AACA,qDAAoD,mEAAmE;AACvH;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA","file":"./lib/bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 3f71984c1a90480317a3","const Image = require('./image');\n\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  Image.createDropbox();\n});\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lib/tableau.js\n// module id = 0\n// module chunks = 0","const Filter = require('./filter');\n\nconst matrices = {\n  \"Sharpen\" : [[0, -1, 0, -1, 5, -1, 0, -1, 0], 1],\n  \"Gaussian Blur\" : [[1, 2, 1, 2, 4, 2, 1, 2, 1], 1/16],\n  \"Edge Detection\" : [[-1, -1, -1, -1, 8, -1, -1, -1, -1], 1],\n  \"Edge Sharpen\" : [[1, 1, 1, 1, -7, 1, 1, 1, 1], 1],\n  \"Motion Blur\" : [[1, 0, 0, 0, 1, 0, 0, 0, 1], 1/3],\n  \"Emboss\" : [[-1, -1, 0, -1, 0, 1, 0, 1, 1], 1],\n  \"Unsharp\" : [[1, 4, 6, 4, 1, 4, 16, 24, 16, 4, 6, 24, -476, 24, 6, 4, 16, 24, 16, 4, 1, 4, 6, 4, 1], -1/256]\n};\n\nclass Image {\n  constructor(image) {\n    this.origImage = document.createElement(\"img\");\n    this.origImage.file = image;\n    this.canvasEl = null;\n    this.filterOrder = [];\n    this.imageCache = [];\n    this.cacheIdx = 0;\n    this.fullImgCanvas = null;\n  }\n\n  static createDropbox() {\n    let dropbox = document.getElementById('dropbox');\n\n    const dragenter = (e) => {\n      e.stopPropagation();\n      e.preventDefault();\n    };\n\n    const dragover = (e) => {\n      e.stopPropagation();\n      e.preventDefault();\n    };\n\n    const drop = (e) => {\n      e.stopPropagation();\n      e.preventDefault();\n      let dataTransfer = e.dataTransfer;\n      let files = dataTransfer.files;\n\n      Image.handleFile(files[0]);\n    };\n\n    dropbox.addEventListener(\"dragenter\", dragenter, false);\n    dropbox.addEventListener(\"dragover\", dragover, false);\n    dropbox.addEventListener(\"drop\", drop, false);\n  }\n\n  static handleFile(file) {\n    let imageObject = new Image(file);\n\n    let reader = new FileReader();\n\n    reader.onload = (e) => {\n      imageObject.origImage.src = e.target.result;\n\n      imageObject.createCanvasEl();\n      // imageObject.addWindowResize();\n    };\n\n    reader.readAsDataURL(file);\n  }\n\n  createCanvasEl() {\n    let $canvasDiv = $('.dynamic-canvas');\n\n    let imgDimensions = this.imageResize(0.8);\n\n    let $ctx = $('<canvas/>').attr({width: imgDimensions[0], height: imgDimensions[1], id: 'image-canvas'});\n    let c = $ctx[0].getContext('2d');\n    c.drawImage(this.origImage, 0, 0, ...imgDimensions);\n    let $dropbox = $('.dropbox-and-preview');\n\n    this.canvasEl = $ctx[0];\n    // this.imageCache.push(c.getImageData(0, 0, c.width, c.height));\n    $dropbox.remove();\n    $canvasDiv.append($ctx);\n    this.buildFilterElements();\n    this.buildUtilityElements();\n  }\n\n  imageResize(percentage) {\n    let wWidth = window.innerWidth;\n    let wHeight = window.innerHeight;\n    let maxHeight = wHeight * percentage;\n    let maxWidth = wWidth * percentage;\n    let maxImgWidth = maxWidth;\n    let maxImgHeight = maxImgWidth * (this.origImage.height / this.origImage.width);\n\n    if (maxImgHeight > maxHeight) {\n      maxImgHeight = maxHeight;\n      maxImgWidth = maxImgHeight * (this.origImage.width / this.origImage.height);\n    }\n\n    if (maxImgWidth > this.origImage.width || maxImgHeight > this.origImage.height) {\n      return [this.origImage.width, this.origImage.height];\n    }\n\n    return [maxImgWidth, maxImgHeight];\n  }\n\n  addWindowResize() {\n    $(window).resize(() => {\n      let $canvasDiv = $('#image-canvas');\n      $canvasDiv.remove();\n      this.createCanvasEl();\n    });\n  }\n\n  buildFilterElements() {\n    let $filterDiv = $('.filters');\n\n    let sharpen = \"Sharpen\";\n    let $sharpenButton = $('<button/>').html(sharpen);\n    $sharpenButton.click(this.applyFilter(this.canvasEl, matrices[sharpen][0], matrices[sharpen][1]));\n    $filterDiv.append($sharpenButton);\n\n    let gaussian = \"Gaussian Blur\";\n    let $gaussianButton = $('<button/>').html(gaussian);\n    $gaussianButton.click(this.applyFilter(this.canvasEl, matrices[gaussian][0], matrices[gaussian][1]));\n    $filterDiv.append($gaussianButton);\n\n    let edgeDet = \"Edge Detection\";\n    let $edgeButton = $('<button/>').html(edgeDet);\n    $edgeButton.click(this.applyFilter(this.canvasEl, matrices[edgeDet][0], matrices[edgeDet][1]));\n    $filterDiv.append($edgeButton);\n\n    let edgeSharp = \"Edge Sharpen\";\n    let $edgeSharpenButton = $('<button/>').html(edgeSharp);\n    $edgeSharpenButton.click(this.applyFilter(this.canvasEl, matrices[edgeSharp][0], matrices[edgeSharp][1]));\n    $filterDiv.append($edgeSharpenButton);\n\n    let motion = \"Motion Blur\";\n    let $motionButton = $('<button/>').html(motion);\n    $motionButton.click(this.applyFilter(this.canvasEl, matrices[motion][0], matrices[motion][1]));\n    $filterDiv.append($motionButton);\n\n    let emboss = \"Emboss\";\n    let $embossButton = $('<button/>').html(emboss);\n    $embossButton.click(this.applyFilter(this.canvasEl, matrices[emboss][0], matrices[emboss][1]));\n    $filterDiv.append($embossButton);\n\n    let unsharp = \"Unsharp\";\n    let $unsharpButton = $('<button/>').html(unsharp);\n    $unsharpButton.click(this.applyFilter(this.canvasEl, matrices[unsharp][0], matrices[unsharp][1]));\n    $filterDiv.append($unsharpButton);\n\n    let $megaBlurButton = $('<button/>').html(\"Unsharp + Mask\");\n    $megaBlurButton.click(this.applyFilter(this.canvasEl));\n    $filterDiv.append($megaBlurButton);\n    // let $greyButton = $('<button/>').html(\"grey filter\");\n    // $greyButton.click(this.applyFilter(this.greyFilter));\n    // $filterDiv.append($greyButton);\n  }\n\n  buildUtilityElements() {\n    let $utilityDiv = $('.utilities');\n    // let $saveLink = $('<a/>').html(\"Save\").attr({href: \"#\"});\n    let saveLink = document.createElement('a');\n    saveLink.innerHTML = \"Save\";\n    saveLink.href = \"#\";\n\n    saveLink.addEventListener('click', () => {\n      this.buildFullImgCanvas();\n      this.downloadImage(saveLink, 'canvas.jpg');\n    });\n\n    let $undoButton = $('<button/>').html(\"Undo\");\n    $undoButton.click(() => {\n      this.undoOperation();\n    });\n\n    $utilityDiv.append(saveLink, $undoButton);\n  }\n  //\n  // testFunction(link) {\n  //   this.buildFullImgCanvas();\n  //   this.downloadImage(link, 'canvas.jpg');\n  // }\n\n  downloadImage(link, filename) {\n    let canvas = this.fullImgCanvas;\n    // canvas.toBlob((blob) => {\n    //   link.href = URL.createObjectURL(blob);\n    //   link.download = filename;\n    // }, \"image/jpeg\", 1);\n\n    link.href = this.fullImgCanvas.toDataURL();\n    link.download = filename;\n  }\n\n  applyFilter(canvas, matrix, weight) {\n    return (e) => {\n      e.preventDefault();\n      let filterObject = new Filter(canvas, matrix, weight);\n      let filterData;\n\n      if (matrix) {\n        filterData = filterObject.updateImageData();\n      } else {\n        filterData = filterObject.megaBlur(80);\n      }\n\n      let ctx = canvas.getContext('2d');\n      ctx.putImageData(filterData, 0, 0);\n      this.updateOrder(filterData, filterObject);\n    };\n  }\n\n  undoOperation() {\n    let ctx = this.canvasEl.getContext('2d');\n\n    console.log(this.imageCache);\n    ctx.putImageData(this.imageCache[this.cacheIdx - 1], 0, 0);\n    this.cacheIdx -= 1;\n  }\n\n  updateOrder(imageData, filterObject) {\n    // let newCache = this.imageCache.slice(0, this.currentIndex + 1);\n\n    this.imageCache.push(imageData);\n\n    if (this.cacheIdx === null) {\n      this.cacheIdx = 0;\n    } else {\n      this.cacheIdx += 1;\n    }\n\n    this.filterOrder.push(filterObject);\n\n    if (this.imageCache.length > 4) {\n      this.imageCache.shift();\n      this.cacheIdx -= 1;\n    }\n\n    console.log(this.cacheIdx);\n  }\n\n  buildFullImgCanvas() {\n    let $canvas = $('<canvas/>').attr({width: this.origImage.width, height: this.origImage.height});\n    this.fullImgCanvas = $canvas[0];\n    let ctx = this.fullImgCanvas.getContext('2d');\n    ctx.drawImage(this.origImage, 0, 0);\n\n    this.filterOrder.forEach((filter) => {\n      filter.currentCanvas = this.fullImgCanvas;\n      let filterData;\n      if (filter.filterMatrix) {\n        filterData = filter.updateImageData();\n      } else {\n        filterData = filter.megaBlur(80);\n      }\n\n      ctx.putImageData(filterData, 0, 0);\n    });\n  }\n}\n\nmodule.exports = Image;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lib/image.js\n// module id = 1\n// module chunks = 0","class Filter {\n  constructor(currentCanvas, filterMatrix, weight) {\n    this.currentCanvas = currentCanvas;\n    this.filterMatrix = filterMatrix;\n    this.weight = weight;\n  }\n\n  greyFilter(canvas) {\n    let ctx = canvas.getContext('2d');\n\n    let ImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n    let data = ImageData.data;\n\n    for (var i = 0; i < data.length; i += 4) {\n      let newValue = 0.299 * data[i] + 0.587 * data[i + 1] + 0.114 * data[i + 2];\n      data[i] = newValue;\n      data[i + 1] = newValue;\n      data[i + 2] = newValue;\n    }\n    // this.cache.push(ImageData);\n    // this.currentIndex++;\n    ctx.putImageData(ImageData, 0, 0);\n  }\n\n  updateImageData() {\n    let ctx = this.currentCanvas.getContext('2d');\n    let imageData = ctx.getImageData(0, 0, this.currentCanvas.width, this.currentCanvas.height);\n    let data = imageData.data;\n    let dupeData = data.slice();\n\n    for (var i = 0; i < dupeData.length; i++) {\n      if (i % 4 === 3) continue;\n\n      let pixelMatrix;\n      if (this.filterMatrix.length === 9) {\n        pixelMatrix = this.calculateMatrix3(i, dupeData, this.currentCanvas.width);\n      } else {\n        pixelMatrix = this.calculateMatrix5(i, dupeData, this.currentCanvas.width);\n      }\n\n      let newValue = this.filteredPixelValue(pixelMatrix, this.filterMatrix);\n\n      if (newValue < 0) {\n        data[i] = 0;\n      } else if (newValue > 255) {\n        data[i] = 255;\n      } else {\n        data[i] = newValue;\n      }\n    }\n\n    return imageData;\n  }\n\n  calculateMatrix3(idx, data, width) {\n    let matrix = [];\n\n    if (idx - width * 4 < 0) {\n      matrix.push(data[idx - 4], data[idx], data[idx + 4]);\n    } else {\n      let offset = idx - (width * 4);\n      matrix.push(data[offset - 4], data[offset], data[offset + 4]);\n    }\n\n    matrix.push(data[idx - 4], data[idx], data[idx + 4]);\n\n    if (idx + width * 4 > data.length) {\n      matrix.push(data[idx - 4], data[idx], data[idx + 4]);\n    } else {\n      let offset = idx + (width * 4);\n      matrix.push(data[offset - 4], data[offset], data[offset + 4]);\n    }\n\n    return matrix;\n  }\n\n  calculateMatrix5(idx, data, width) {\n    let matrix = [];\n\n    if (idx - width * 4 < 0) {\n      matrix.push(data[idx - 8], data[idx - 4], data[idx], data[idx + 4], data[idx + 8]);\n    } else {\n      let offset = idx - (width * 4);\n      matrix.push(data[offset - 8], data[offset - 4], data[offset], data[offset + 4], data[offset + 8]);\n    }\n\n    matrix.push(data[idx - 8], data[idx - 4], data[idx], data[idx + 4], data[idx + 8]);\n\n    if (idx + width * 4 > data.length) {\n      matrix.push(data[idx - 8], data[idx - 4], data[idx], data[idx + 4], data[idx + 8]);\n    } else {\n      let offset = idx + (width * 4);\n      matrix.push(data[offset - 8], data[offset - 4], data[offset], data[offset + 4], data[offset + 8]);\n    }\n\n    return matrix;\n  }\n\n  filteredPixelValue(pixelMatrix, filterMatrix) {\n    let sum = 0;\n    pixelMatrix.forEach((pVal, idx) => (sum += pVal * filterMatrix[idx]));\n\n    return sum * this.weight;\n  }\n\n  megaBlur(n) {\n    let ctx = this.currentCanvas.getContext('2d');\n    let imageData = ctx.getImageData(0, 0, this.currentCanvas.width, this.currentCanvas.height);\n    let data = imageData.data;\n    let origData = data.slice();\n    let dupeData = data.slice();\n\n    for (var x = 0; x < this.currentCanvas.width; x++) {\n      for (var y = 0; y < this.currentCanvas.height; y++) {\n        let neighbors = this.getVertNeighbors(dupeData, n, x, y);\n        let sum = neighbors.reduce((rgb, accum) => {\n          return [rgb[0] + accum[0], rgb[1] + accum[1], rgb[2] + accum[2]];\n        });\n        let averages = sum.map((value) => (Math.floor(value / neighbors.length)));\n        this.writePixel(data, averages, x, y);\n      }\n    }\n\n    dupeData = data.slice();\n    for (var x = 0; x < this.currentCanvas.width; x++) {\n      for (var y = 0; y < this.currentCanvas.height; y++) {\n        let neighbors = this.getHorNeighbors(dupeData, n, x, y);\n        let sum = neighbors.reduce((rgb, accum) => {\n          return [rgb[0] + accum[0], rgb[1] + accum[1], rgb[2] + accum[2]];\n        });\n        let averages = sum.map((value) => (Math.floor(value / neighbors.length)));\n        this.writePixel(data, averages, x, y);\n      }\n    }\n\n    for (var x = 0; x < this.currentCanvas.width; x++) {\n      for (var y = 0; y < this.currentCanvas.height; y++) {\n        let blurredRgb = this.readPixel(data, x, y);\n        let origRgb = this.readPixel(origData, x, y);\n        let newRgb = origRgb.map((val, idx) => val + (val - blurredRgb[idx]) * 0.2);\n        this.writePixel(data, newRgb, x, y);\n      }\n    }\n\n    return imageData;\n  }\n\n  getVertNeighbors(data, n, x, y) {\n    let neighbors = [];\n    for (var i = Math.max(y - Math.floor(n / 2), 0); i < Math.min(y + Math.floor(n / 2), this.currentCanvas.height - 1); i++) {\n      neighbors.push(this.readPixel(data, x, i));\n    }\n\n    return neighbors;\n  }\n\n  getHorNeighbors(data, n, x, y) {\n    let neighbors = [];\n    for (var i = Math.max(x - Math.floor(n / 2), 0); i < Math.min(x + Math.floor(n / 2), this.currentCanvas.width - 1); i++) {\n      neighbors.push(this.readPixel(data, i, y));\n    }\n\n    return neighbors;\n  }\n\n  readPixel(imageData, x, y) {\n    let i = (y * this.currentCanvas.width + x) * 4;\n    return [imageData[i], imageData[i + 1], imageData[i + 2]];\n  }\n\n  writePixel(imageData, pixelValues, x, y) {\n    let [r, g, b] = pixelValues;\n    let i = (y * this.currentCanvas.width + x) * 4;\n\n    imageData[i] = r;\n    imageData[i + 1] = g;\n    imageData[i + 2] = b;\n  }\n}\n\nmodule.exports = Filter;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lib/filter.js\n// module id = 2\n// module chunks = 0"],"sourceRoot":""}